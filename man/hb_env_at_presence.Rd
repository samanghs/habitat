% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/env_at_presence.R
\name{hb_env_at_presence}
\alias{hb_env_at_presence}
\title{Analyze environmental values at species presence}
\usage{
hb_env_at_presence(
  env_raster,
  suit_raster,
  threshold = 0.5,
  mask_geom = NULL,
  plot = TRUE,
  breaks = NULL,
  col = "lightgray",
  border = NA,
  main = "Environmental values at presence locations",
  xlab = "Environmental value",
  ylab = "Frequency",
  na_rm = TRUE
)
}
\arguments{
\item{env_raster}{A SpatRaster (preferred) or RasterLayer of the environmental variable
(e.g., elevation in meters, slope in degrees).}

\item{suit_raster}{A SpatRaster or RasterLayer representing species suitability or
presence probability. If already binary (0/1), set \code{threshold = NULL}.}

\item{threshold}{Numeric or NULL. Threshold applied to \code{suit_raster} to derive
presence (1) vs absence (0). If \code{NULL}, values > 0 are treated as presence.}

\item{mask_geom}{Optional SpatVector or SpatRaster mask/crop geometry (e.g., a border).
If provided, \code{env_raster} is cropped and masked to this geometry before analysis.}

\item{plot}{Logical. If TRUE, a histogram is plotted immediately.}

\item{breaks}{Integer or vector. Breaks passed to \code{hist()} for the histogram.
Defaults to "Sturges" via \code{breaks = "Sturges"} if left NULL.}

\item{col}{Character. Fill color for the histogram bars. Default \code{"lightgray"}.}

\item{border}{Character. Border color for the histogram bars. Default \code{NA}.}

\item{main}{Character. Plot title. Default \code{"Environmental values at presence locations"}.}

\item{xlab}{Character. X-axis label. Default \code{"Environmental value"}.}

\item{ylab}{Character. Y-axis label. Default \code{"Frequency"}.}

\item{na_rm}{Logical. Whether to remove NA values in summaries. Default \code{TRUE}.}
}
\value{
A named list with:
\itemize{
\item \code{summary}: a data.frame with Min, Q1, Median, Mean, Q3, Max, SD, N
\item \code{values}: a numeric vector of extracted environmental values at presence cells
\item \code{presence_mask}: the SpatRaster (0/1) presence mask used for extraction
}
}
\description{
Computes descriptive statistics and plots a histogram of an
environmental raster (e.g., elevation, slope) at species presence locations
defined by a binary/suitability raster and a threshold. This wraps the common
workflow of masking the environmental layer by presence, extracting values,
summarizing them, and visualizing their distribution.
}
\details{
The function aligns CRS and geometry between \code{env_raster} and \code{suit_raster}
and uses nearest-neighbor methods for reprojection/resampling to preserve binary
presence masks derived from the suitability raster. Presence cells are defined as:
\itemize{
\item if \code{threshold} is numeric: \code{suit_raster >= threshold}
\item if \code{threshold} is NULL: \code{suit_raster > 0}
}

The histogram is drawn with base R \code{hist()} for speed and simplicity. Returned
statistics include Min, 1st Qu., Median, Mean, 3rd Qu., Max, SD, and N.
}
\examples{
\dontrun{
env <- rast(system.file("ex/elev.tif", package = "terra"))
suit <- env / max(values(env), na.rm = TRUE)  # fake suitability 0..1

# Analyze elevation values where suitability >= 0.5 and plot histogram
res <- hb_env_at_presence(
  env_raster = env,
  suit_raster = suit,
  threshold = 0.5,
  plot = TRUE,
  col = "lightblue",
  main = "Elevation at presence (>= 0.5)",
  xlab = "Elevation (m)"
)
res$summary
}

}
